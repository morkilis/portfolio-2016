var eve = eve || {},
    merchant = eve.merchant = eve.merchant || {}

;(function() {
    'use strict'

    var AllDealsModel = merchant.AllDealsModel
    merchant.AllDealsView = Backbone.View.extend({
        el: '#merchant',
        model: AllDealsModel,
        template: Handlebars.compile(eve.merchant.tmpl.all_deals),
        initialize: function() {
            _.bindAll(this, 'buildView')
            AllDealsModel.on('change', this.buildView, this)

            return this
        },
        buildView: function() {
            var that = this
            eve.run(function() {
                if (!initData.hasBought) {
                    that.$el.find('#loading_tips').before(that.template(that.model.toJSON()))
                } else {
                    that.$el.find('#loading_tips').remove()
                    that.$el.append(that.template(that.model.toJSON()))
                }
            }, {
                url: 'merchant all deals view buildView()'
            })
        }
    })
}())
