var eve = eve || {}
    cinema = eve.cinema = eve.cinema || {}

cinema.API = 'http://api.mobile.meituan.com/dianying/'

;(function() {
    'use strict'

    // prepare init data
    initData.price = fixedNum(initData.price, 1)
    initData.value = fixedNum(initData.value, 1)

    // initialize
    $(
        eve.run(function() {
            var ScheduleModel = cinema.ScheduleModel,
                ScheduleView = cinema.ScheduleView

            ScheduleModel.fetch({
                dataType: "jsonp",
                silent: true,
                success: function(model) {
                    var todayData = model.get('temp')

                    model.unset('temp', {silent: true})
                    _.extend(todayData, {current: 'today'})
                    model.set({ today: todayData })
                    return model
                },
                error: function(e) {
                    eve.log(e)
                    var errMsg = '暂无影讯信息',
                        todayData = _.extend({
                            errMsg: errMsg
                        }, {current: 'today'})

                    if (!navigator.onLine) {
                        errMsg = '网络连接已断开，请连线后重试'
                    }
                    ScheduleModel.set({ today: todayData })
                }
            })

            new ScheduleView()
        })
    )

    /**
     * @description fixed float number
     * @param {Number} num: origin number
     * @param {Number} dot: count of numbers after the dot
     */
    function fixedNum(num, dot) {
        return num.toString().indexOf('.') > -1 ? num.toFixed(dot) : num
    }
}())
