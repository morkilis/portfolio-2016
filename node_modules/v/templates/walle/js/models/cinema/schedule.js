var eve = eve || {},
    cinema = eve.cinema = eve.cinema || {},
    initParams = initParams || '';

;(function() {
    'use strict'

    var API = 'http://api.mobile.meituan.com/dianying/',
        scheduleURL = 'poi/movieshows.json?'

    var ScheduleModel = Backbone.Model.extend({
        urlRoot: function() {
            // poi/movieshows.json?pois=1466992&dt=2012-10-09
            return (cinema.API + scheduleURL + 'pois=' + initData.merchantInfo.poiid + '&dt=' + (new Date()).toISOString().split('T')[0]) + initParams
        },
        parse: function(res) {
            var ret = {
                temp: {
                    schedule: []
                }
            }

            res[initData.merchantInfo.poiid].forEach(function(mov, index) {
                var movie = ret.temp.schedule[index] = {
                    id: mov.id,
                    name: mov.nm,
                    duration: mov.dur,
                    types: []
                }

                mov.plist.forEach(function(m) {
                    var type = (m.tp || '') + (m.lang || '')

                    if (movie.types.indexOf(type) === -1) {
                        movie.types.push(type)
                        movie[type] = []
                    }
                    movie[type].push({ time: m.tm })
                })
            })

            return ret
        },
    })

    cinema.ScheduleModel = new ScheduleModel
}())
