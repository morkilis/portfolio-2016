define(function(require, exports, module) {
    'use strict'

    if ('undefined' === typeof initData) {
        M.log({
            msg: '**EVE** initData is undefined',
            url: '/js/models/detail.js'
        })
        return
    }

    var _ = require('_'),
        Backbone = require('Backbone')

    // merchant detail model
    var Detail = Backbone.Model.extend({
        parse: function(originData) {
            var ori = originData,
                ret = ori,
                merchant = ori.merchantInfo,
                phone = merchant ? merchant.phone : null,
                phoneNumber = ''

            if (phone.indexOf('/') > -1) {
                phone = phone.split('/')[0]
            }
            phoneNumber = phone.replace(/\-/, '')

            ret.dealid = ret.dealId
            ret.phoneNumber = phoneNumber
            // iMeituan://merchantMap/$title/$lat/$long
            ret.mapLink = 'iMeituan://merchantMap/' + merchant.name + '/' + merchant.lat + '/' + merchant.lng

            _.extend(ret, merchant)
            delete ret.merchantInfo
            delete ret.dealId

            return ret
        }
    })

    // detail model
    module.exports = new Detail(initData, {parse: true})
})
