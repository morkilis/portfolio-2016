define(function(require, exports, module) {
    'use strict'

    // app's configuration
    M.config.site = "cinema"
    // M.config.API = "http://dianying.meituan.com/api/"
    M.config.API = "http://srv29.sankuai.com:8888/api/"
    if (location.href.indexOf('debug') > -1) {
        M.config.debug = true
    }

    var $ = require('$'),
        Handlebars = require('Handlebars'),
        _ = require('_'),
        Backbone = require('Backbone')

    var ScheduleModel = require('/js/models/schedule')
        , ScheduleView = require('/js/views/schedule')

    ScheduleModel.fetch({
        dataType: "jsonp",
        silent: true,
        success: function(model) {
            var todayData = model.get('temp')

            model.unset('temp', {silent: true})
            _.extend(todayData, {current: 'today'})
            model.set({ today: todayData })
            return model
        },
        error: function(e) {
            M.log(e)
            var errMsg = '暂无影讯信息',
                todayData = _.extend({
                    errMsg: errMsg
                }, {current: 'today'})

            if (!navigator.onLine) {
                errMsg = '网络连接已断开，请连线后重试'
            }
            ScheduleModel.set({ today: todayData })
        }
    })

    new ScheduleView()
})